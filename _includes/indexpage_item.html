{% assign article_date = article.date | date: "%Y-%m-%d" %}
{% assign button_class = "card-link appear-up link-no-style link-article mdl-button mdl-js-button mdl-js-ripple-effect" %}

{% if article.link %}
  <a href="{{ article.link }}" class="{{ button_class }}" target="_blank" rel="noopener">
{% else %}
  <a href="{{ article.url }}" class="{{ button_class }}">
{% endif %}

<div class="card-wrapper">
  <div class="card">
      {% if article.link %}
        <div class="read-article-external lazyload" hover-text-content="Read Article">
      {% else %}
        <div class="read-article lazyload" hover-text-content="Read Article">
      {% endif %}

      {% assign full_bg = true %}
      {% if article.preview_full_background == false %}
        {% assign full_bg = false %}
      {% endif %}

      {% assign blurred_bg = true %}
      {% if article.preview_blur == false %}
        {% assign blurred_bg = false %}
      {% endif %}

      {% if article.preview_image %}
        <div src="/post_images/{{ article_date }}/{{ article.preview_image }}" loading="lazy" class="preview-img" blur-bg="{{ blurred_bg }}" full-background="{{ full_bg }}"></div>
      {% else %}
        {% comment %}
          <!-- Generate a random image for posts, that should stay same for it's lifetime (unless modified the time) -->
        {% endcomment %}

        {% assign time1 = article.date | date: '%H.%M' %}
        {% assign time2 = article.date | date: '%d.%w' %}
        {% assign time3 = article.date | date: '%m.%j' %}
        {% assign time4 = article.date | date: '%y.%u' %}

        {% assign prev_counter_2 = prev_counter | divided_by: 2 %}
        {% assign random_index = time1 | plus: time2 | plus: time3 | plus: time4 | round | modulo: max_images | minus: prev_counter_2 | abs %}
        {% assign prev_counter = random_index %}

        <div src="/default_images/image-{{ random_index}}.jpg" loading="lazy" class="preview-img" blur-bg="{{ blurred_bg }}" full-background="{{ full_bg }}" auto-text="{{ article.title }}"></div>
      {% endif %}
      <div class="lazyload-anim"></div>
    </div>

    <div class="page-content-body">
      <div class="p-2rem">
        <div class="date mt-1rem mb-1rem font-montseratt">
          {{ article.date | date: '%-d %B %Y'}}
        </div>

        <div class="heading mb-1rem">
          {% if article.link %}
            <h4 class="line-clamp-3 font-montseratt">
              {{ article.title }}
            </h4>
          {% elsif article.file %}
            <h4 class="line-clamp-3">{{ article.title }}</h4>
          {% else %}
            Untitled
          {% endif %}
        </div>

        <div class="pb-1rem">
          <div class="description font-roboto">
            {% if article.description %}
              {{ article.description }}
            {% else %}
              {{ article.title }}
            {% endif %}
          </div>
        </div>

        <div class="author font-suisseintl">
          {% if article.author %}
            {{ article.author }}
          {% else %}
            Ruby News
          {% endif %}
        </div>

        {% if article.tags %}
          <div class="tags">
            <ul>
              {% for tag in article.tags %}
                  <li>{{ tag }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

      </div>
    </div>
  </div>
</div>

</a>
